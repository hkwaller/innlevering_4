angular.module("TopSecret",["app.controllers","app.services","ui.router","ngResource","ngNotify"]).config(["$stateProvider","$urlRouterProvider","$httpProvider",function(o,t,e){t.otherwise("/login"),o.state("login",{url:"/login",templateUrl:"partials/login.html",controller:"LoginCtrl",onEnter:["$state",function(o){window.sessionStorage.token&&o.go("main")}]}).state("main",{url:"/main",templateUrl:"partials/main.html",controller:"MainCtrl",onEnter:["$state","$rootScope","$http",function(o,t,e){window.sessionStorage.token?t.token=window.sessionStorage.token:o.go("login")}]}).state("post",{url:"/post",templateUrl:"partials/post.html",controller:"PostCtrl",onEnter:["$state","$rootScope","$http",function(o,t,e){window.sessionStorage.token?t.token=window.sessionStorage.token:o.go("login")}]}).state("edit",{url:"/edit/:id",templateUrl:"partials/edit.html",controller:"EditCtrl",onEnter:["$state","$rootScope","$http",function(o,t,e){window.sessionStorage.token?t.token=window.sessionStorage.token:o.go("login")}]})}]).run(["$rootScope","$timeout","$location",function(o,t,e){!function n(){var s="ws://"+e.host()+":"+e.port(),r=new WebSocket(s);r.onclose=function(o){console.log("WebSocket closed. Reconnecting..."),t(n,1e4)},r.onmessage=function(t){var e=JSON.parse(t.data);void 0!==e.data&&e.data["public"]&&o.$broadcast("ws:"+e.topic,e.data)},r.onopen=function(){console.log("WebSocket connected..")}}()}]),angular.module("app.controllers",[]).controller("LoginCtrl",["$scope","$http","$animate","$window","$location","$rootScope","ngNotify","UserService",function(o,t,e,n,s,r,i,a){o.login=function(o){t.post("/authenticate",{username:o.username,password:o.password}).success(function(e,i,a,u){n.sessionStorage.token=e,r.username=o.username,t.defaults.headers.common["X-Auth"]=e,r.token=e,s.path("/main")}).error(function(o,t,e,s){delete n.sessionStorage.token,i.set("Something went wrong, try again",{type:"error",duration:2e3})})},o.signup=function(e){var n={username:e.username,password:e.password};t.post("/signUp",n).success(function(t){o.user={username:"",password:""},i.set("You are registered, now you can login",{type:"success",duration:2e3})}).error(function(){i.set("Username is taken, try again",{type:"error",duration:2e3})})}}]).controller("MainCtrl",["$scope","$window","$location","$rootScope","ngNotify","$http","UserService","$resource",function(o,t,e,n,s,r,i,a){o.posts=[];var u=a("http://"+e.host()+":"+e.port()+"/api/posts");r.defaults.headers.common["x-auth"]=n.token,i.getUser().success(function(o){n.currentUser=o,n.username=o.username}),r.get("http://"+e.host()+":"+e.port()+"/api/posts").success(function(t){o.posts=t}).error(function(o){s.set("Something went wrong. I don't know what",{type:"error",duration:2e3})}),o.postController=!1,o.$on("ws:new_post",function(t,e){o.$apply(function(){o.posts.unshift(e),s.set("A new post was posted",{type:"info",duration:2e3})})}),o.$on("ws:delete_post",function(t,e){o.$apply(function(){angular.forEach(o.posts,function(t,r){return t._id===e._id&&e.username!==n.username?(o.posts.splice(o.posts.indexOf(t),1),void s.set("Someone deleted a post :(",{type:"warn",duration:2e3})):void 0})})}),o.$on("ws:update_post",function(t,e){o.$apply(function(){angular.forEach(o.posts,function(o,t){return o._id===e._id?(o=e,void s.set("Someone updated a post",{type:"info",duration:2e3})):void 0})})}),o["delete"]=function(t){(t.username=n.username)?u.remove({id:t._id},function(){for(var e=0;e<o.posts.length;e++)t._id===o.posts[e]._id&&(s.set("Your post is now doomed into oblivion",{type:"error",duration:2e3}),o.posts.splice(e,1))}):s.set("Are you trying something fishy?",{type:"error",duration:2e3})},o.edit=function(o){e.path("/edit/"+o._id)},o.logout=function(){i.logout()}}]).controller("PostCtrl",["$scope","$rootScope","$location","$http","$window","ngNotify","$timeout","UserService",function(o,t,e,n,s,r,i,a){o.postController=!0,n.defaults.headers.common["X-Auth"]=s.sessionStorage.token,a.getUser().success(function(o){t.currentUser=o,t.username=o.username}),o.submit=function(o){void 0===o?r.set("Empty post, eh?",{type:"error",duration:2e3}):(o.username=t.username,n.post("/api/posts",o).success(function(o){r.set("Your post was added to the brilliant archive",{type:"success",duration:1e3}),i(function(){e.path("/main")},1e3)}).error(function(){console.log("Something went wrong")}))},o.logout=function(){a.logout()}}]).controller("EditCtrl",["$scope","$rootScope","$location","$http","$window","ngNotify","$stateParams","$timeout","UserService",function(o,t,e,n,s,r,i,a,u){n.defaults.headers.common["X-Auth"]=s.sessionStorage.token,u.getUser().success(function(o){t.currentUser=o,t.username=o.username}),n.get("/api/post/"+i.id).success(function(t){o.post=t}).error(function(o){r.set("Something went wrong. I don't know what",{type:"error",duration:2e3})}),o.submit=function(o){void 0===o?r.set("Empty post, eh?",{type:"error",duration:2e3}):n.put("/api/update",o).success(function(o){r.set("Your post was added updated",{type:"success",duration:1e3}),a(function(){e.path("/main")},1e3)}).error(function(){console.log("Something went wrong")})},o.logout=function(){u.logout()}}]),angular.module("app.services",[]).service("UserService",["$http","$location","$window",function(o,t,e){var n=this;this.getUser=function(){return o.get("/currentUser",{headers:{"X-Auth":window.sessionStorage.token}})},this.logout=function(){delete n.token,delete e.sessionStorage.token,o.defaults.headers.common["X-Auth"]=null,t.path("/")}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImNvbnRyb2xsZXJzLmpzIiwic2VydmljZXMuanMiXSwibmFtZXMiOlsiYW5ndWxhciIsIm1vZHVsZSIsImNvbmZpZyIsIiRzdGF0ZVByb3ZpZGVyIiwiJHVybFJvdXRlclByb3ZpZGVyIiwiJGh0dHBQcm92aWRlciIsIm90aGVyd2lzZSIsInN0YXRlIiwidXJsIiwidGVtcGxhdGVVcmwiLCJjb250cm9sbGVyIiwib25FbnRlciIsIiRzdGF0ZSIsIndpbmRvdyIsInNlc3Npb25TdG9yYWdlIiwidG9rZW4iLCJnbyIsIiRyb290U2NvcGUiLCIkaHR0cCIsInJ1biIsIiR0aW1lb3V0IiwiJGxvY2F0aW9uIiwiY29ubmVjdCIsImhvc3QiLCJwb3J0IiwiY29ubmVjdGlvbiIsIldlYlNvY2tldCIsIm9uY2xvc2UiLCJlIiwiY29uc29sZSIsImxvZyIsIm9ubWVzc2FnZSIsInBheWxvYWQiLCJKU09OIiwicGFyc2UiLCJkYXRhIiwidW5kZWZpbmVkIiwiJGJyb2FkY2FzdCIsInRvcGljIiwib25vcGVuIiwiJHNjb3BlIiwiJGFuaW1hdGUiLCIkd2luZG93IiwibmdOb3RpZnkiLCJVc2VyU2VydmljZSIsImxvZ2luIiwidXNlciIsInBvc3QiLCJ1c2VybmFtZSIsInBhc3N3b3JkIiwic3VjY2VzcyIsInN0YXR1cyIsImhlYWRlcnMiLCJkZWZhdWx0cyIsImNvbW1vbiIsInBhdGgiLCJlcnJvciIsInNldCIsInR5cGUiLCJkdXJhdGlvbiIsInNpZ251cCIsIm5ld1VzZXIiLCIkcmVzb3VyY2UiLCJwb3N0cyIsIlBvc3RzIiwiZ2V0VXNlciIsImN1cnJlbnRVc2VyIiwiZ2V0IiwiZXJyIiwicG9zdENvbnRyb2xsZXIiLCIkb24iLCJfIiwiJGFwcGx5IiwidW5zaGlmdCIsImZvckVhY2giLCJ2YWwiLCJrZXkiLCJfaWQiLCJzcGxpY2UiLCJpbmRleE9mIiwicmVtb3ZlIiwiaWQiLCJpIiwibGVuZ3RoIiwiZWRpdCIsImxvZ291dCIsInN1Ym1pdCIsIm5l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LEdBQUFDLElBRUFBLE1BQUExQixRQUFBLFdBQ0EsTUFBQS9DLEdBQUFpRCxJQUFBLGdCQUNBZixTQUFBd0MsU0FBQS9FLE9BQUFDLGVBQUFDLFVBSUE0RSxLQUFBTixPQUFBLGlCQUNBSyxHQUFBM0UsWUFDQTJCLEdBQUE1QixlQUFBQyxNQUNBRyxFQUFBbUMsU0FBQUQsUUFBQUUsT0FBQSxVQUFBLEtBQ0FqQyxFQUFBa0MsS0FBQSIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJhbmd1bGFyLm1vZHVsZSgnVG9wU2VjcmV0JywgWydhcHAuY29udHJvbGxlcnMnLCAnYXBwLnNlcnZpY2VzJywgJ3VpLnJvdXRlcicsICduZ1Jlc291cmNlJywgJ25nTm90aWZ5J10pXG5cbi5jb25maWcoZnVuY3Rpb24oJHN0YXRlUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlciwgJGh0dHBQcm92aWRlcikge1xuICAgIFxuICAgICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoXCIvbG9naW5cIik7XG5cbiAgICAkc3RhdGVQcm92aWRlclxuICAgIC5zdGF0ZSgnbG9naW4nLCB7XG4gICAgICB1cmw6IFwiL2xvZ2luXCIsXG4gICAgICB0ZW1wbGF0ZVVybDogXCJwYXJ0aWFscy9sb2dpbi5odG1sXCIsXG4gICAgICBjb250cm9sbGVyOiAnTG9naW5DdHJsJyxcbiAgICAgIG9uRW50ZXI6IGZ1bmN0aW9uKCRzdGF0ZSkge1xuICAgICAgICBpZiAod2luZG93LnNlc3Npb25TdG9yYWdlLnRva2VuKSB7XG4gICAgICAgICAgICAkc3RhdGUuZ28oJ21haW4nKVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcbiAgICBcbiAgICAuc3RhdGUoJ21haW4nLCB7XG4gICAgICB1cmw6IFwiL21haW5cIixcbiAgICAgIHRlbXBsYXRlVXJsOiBcInBhcnRpYWxzL21haW4uaHRtbFwiLFxuICAgICAgY29udHJvbGxlcjogJ01haW5DdHJsJyxcbiAgICAgIG9uRW50ZXI6IGZ1bmN0aW9uKCRzdGF0ZSwgJHJvb3RTY29wZSwgJGh0dHApIHtcbiAgICAgICAgaWYgKCF3aW5kb3cuc2Vzc2lvblN0b3JhZ2UudG9rZW4pIHtcbiAgICAgICAgICAgICRzdGF0ZS5nbygnbG9naW4nKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgJHJvb3RTY29wZS50b2tlbiA9IHdpbmRvdy5zZXNzaW9uU3RvcmFnZS50b2tlbjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pXG4gICAgXG4gICAgLnN0YXRlKCdwb3N0Jywge1xuICAgICAgdXJsOiBcIi9wb3N0XCIsXG4gICAgICB0ZW1wbGF0ZVVybDogXCJwYXJ0aWFscy9wb3N0Lmh0bWxcIixcbiAgICAgIGNvbnRyb2xsZXI6ICdQb3N0Q3RybCcsXG4gICAgICBvbkVudGVyOiBmdW5jdGlvbigkc3RhdGUsICRyb290U2NvcGUsICRodHRwKSB7XG4gICAgICAgIGlmICghd2luZG93LnNlc3Npb25TdG9yYWdlLnRva2VuKSB7XG4gICAgICAgICAgICAkc3RhdGUuZ28oJ2xvZ2luJylcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICRyb290U2NvcGUudG9rZW4gPSB3aW5kb3cuc2Vzc2lvblN0b3JhZ2UudG9rZW47XG4gICAgICAgICAgICBcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pXG4gICAgXG4gICAgLnN0YXRlKCdlZGl0Jywge1xuICAgICAgdXJsOiBcIi9lZGl0LzppZFwiLFxuICAgICAgdGVtcGxhdGVVcmw6IFwicGFydGlhbHMvZWRpdC5odG1sXCIsXG4gICAgICBjb250cm9sbGVyOiAnRWRpdEN0cmwnLFxuICAgICAgb25FbnRlcjogZnVuY3Rpb24oJHN0YXRlLCAkcm9vdFNjb3BlLCAkaHR0cCkge1xuICAgICAgICBpZiAoIXdpbmRvdy5zZXNzaW9uU3RvcmFnZS50b2tlbikge1xuICAgICAgICAgICAgJHN0YXRlLmdvKCdsb2dpbicpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkcm9vdFNjb3BlLnRva2VuID0gd2luZG93LnNlc3Npb25TdG9yYWdlLnRva2VuO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcbn0pXG5cbi5ydW4oZnVuY3Rpb24oJHJvb3RTY29wZSwgJHRpbWVvdXQsICRsb2NhdGlvbikge1xuICAgIChmdW5jdGlvbiBjb25uZWN0KCkge1xuICAgICAgICB2YXIgdXJsID0gJ3dzOi8vJyArICRsb2NhdGlvbi5ob3N0KCkgKyAnOicgKyAkbG9jYXRpb24ucG9ydCgpO1xuICAgICAgICB2YXIgY29ubmVjdGlvbiA9IG5ldyBXZWJTb2NrZXQodXJsKTtcbiAgICAgICAgXG4gICAgICAgIGNvbm5lY3Rpb24ub25jbG9zZSA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdXZWJTb2NrZXQgY2xvc2VkLiBSZWNvbm5lY3RpbmcuLi4nKVxuICAgICAgICAgICAgJHRpbWVvdXQoY29ubmVjdCwgMTAqMTAwMCk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbm5lY3Rpb24ub25tZXNzYWdlID0gZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgdmFyIHBheWxvYWQgPSBKU09OLnBhcnNlKGUuZGF0YSk7XG4gICAgICAgICAgICBpZiAocGF5bG9hZC5kYXRhICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBpZiAocGF5bG9hZC5kYXRhLnB1YmxpYykge1xuICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3dzOicgKyBwYXlsb2FkLnRvcGljLCBwYXlsb2FkLmRhdGEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGNvbm5lY3Rpb24ub25vcGVuID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnV2ViU29ja2V0IGNvbm5lY3RlZC4uJyk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgfSkoKSAgICBcbn0pXG4iLCJhbmd1bGFyLm1vZHVsZSgnYXBwLmNvbnRyb2xsZXJzJywgW10pXG5cbi5jb250cm9sbGVyKCdMb2dpbkN0cmwnLCBbJyRzY29wZScsICckaHR0cCcsICckYW5pbWF0ZScsICckd2luZG93JywgJyRsb2NhdGlvbicsICckcm9vdFNjb3BlJywgJ25nTm90aWZ5JywgJ1VzZXJTZXJ2aWNlJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGFuaW1hdGUsICR3aW5kb3csICRsb2NhdGlvbiwgJHJvb3RTY29wZSwgbmdOb3RpZnksIFVzZXJTZXJ2aWNlKSB7XG4gICAgXG4gICRzY29wZS5sb2dpbiA9IGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAkaHR0cC5wb3N0KCcvYXV0aGVudGljYXRlJywge3VzZXJuYW1lOiB1c2VyLnVzZXJuYW1lLCBwYXNzd29yZDogdXNlci5wYXNzd29yZH0pXG4gICAgICAuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcbiAgICAgICAgJHdpbmRvdy5zZXNzaW9uU3RvcmFnZS50b2tlbiA9IGRhdGE7XG4gICAgICAgICRyb290U2NvcGUudXNlcm5hbWUgPSB1c2VyLnVzZXJuYW1lO1xuICAgICAgICAkaHR0cC5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsnWC1BdXRoJ10gPSBkYXRhXG4gICAgICAgICRyb290U2NvcGUudG9rZW4gPSBkYXRhO1xuICAgICAgICAkbG9jYXRpb24ucGF0aCgnL21haW4nKTtcbiAgICAgIH0pXG4gICAgICAuZXJyb3IoZnVuY3Rpb24gKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XG4gICAgICAgIGRlbGV0ZSAkd2luZG93LnNlc3Npb25TdG9yYWdlLnRva2VuO1xuICAgICAgICBuZ05vdGlmeS5zZXQoJ1NvbWV0aGluZyB3ZW50IHdyb25nLCB0cnkgYWdhaW4nLCB7XG4gICAgICAgICAgICB0eXBlOiAnZXJyb3InLFxuICAgICAgICAgICAgZHVyYXRpb246IDIwMDBcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgfVxuICBcbiAgJHNjb3BlLnNpZ251cCA9IGZ1bmN0aW9uKHVzZXIpIHtcblx0XHR2YXIgbmV3VXNlciA9IHtcblx0XHRcdHVzZXJuYW1lOiB1c2VyLnVzZXJuYW1lLFxuXHRcdFx0cGFzc3dvcmQ6IHVzZXIucGFzc3dvcmRcblx0XHR9O1xuXG5cdFx0JGh0dHAucG9zdCgnL3NpZ25VcCcsIG5ld1VzZXIpXG4gICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbih1c2VyKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnVzZXIgPSB7XG4gICAgICAgICAgICAgICAgICAgIFwidXNlcm5hbWVcIjpcIlwiLFxuICAgICAgICAgICAgICAgICAgICBcInBhc3N3b3JkXCI6XCJcIlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBuZ05vdGlmeS5zZXQoJ1lvdSBhcmUgcmVnaXN0ZXJlZCwgbm93IHlvdSBjYW4gbG9naW4nLCB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdzdWNjZXNzJyxcbiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IDIwMDBcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgbmdOb3RpZnkuc2V0KCdVc2VybmFtZSBpcyB0YWtlbiwgdHJ5IGFnYWluJywge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZXJyb3InLFxuICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogMjAwMFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cdH07XG59XSlcbiAgICBcbi5jb250cm9sbGVyKCdNYWluQ3RybCcsIFsnJHNjb3BlJywgJyR3aW5kb3cnLCAnJGxvY2F0aW9uJywgJyRyb290U2NvcGUnLCAnbmdOb3RpZnknLCAnJGh0dHAnLCAnVXNlclNlcnZpY2UnLCAnJHJlc291cmNlJywgZnVuY3Rpb24oJHNjb3BlLCAkd2luZG93LCAkbG9jYXRpb24sICRyb290U2NvcGUsIG5nTm90aWZ5LCAkaHR0cCwgVXNlclNlcnZpY2UsICRyZXNvdXJjZSkgeyAgICBcbiAgICBcbiAgICAkc2NvcGUucG9zdHMgPSBbXTtcbiAgICBcbiAgICB2YXIgUG9zdHMgPSAkcmVzb3VyY2UoJ2h0dHA6Ly8nICsgJGxvY2F0aW9uLmhvc3QoKSArICc6JyArICRsb2NhdGlvbi5wb3J0KCkgKyAnL2FwaS9wb3N0cycpO1xuICAgIFxuICAgICRodHRwLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWyd4LWF1dGgnXSA9ICRyb290U2NvcGUudG9rZW5cbiAgICBcbiAgICBVc2VyU2VydmljZS5nZXRVc2VyKCkuc3VjY2VzcyhmdW5jdGlvbih1c2VyKSB7XG4gICAgICAgICRyb290U2NvcGUuY3VycmVudFVzZXIgPSB1c2VyO1xuICAgICAgICAkcm9vdFNjb3BlLnVzZXJuYW1lID0gdXNlci51c2VybmFtZTtcbiAgICB9KVxuICAgIFxuICAgICRodHRwLmdldCgnaHR0cDovLycgKyAkbG9jYXRpb24uaG9zdCgpICsgJzonICsgJGxvY2F0aW9uLnBvcnQoKSArICcvYXBpL3Bvc3RzJylcbiAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uKHBvc3RzKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnBvc3RzID0gcG9zdHM7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uKGVycikge1xuICAgICAgICAgICAgICAgIG5nTm90aWZ5LnNldCgnU29tZXRoaW5nIHdlbnQgd3JvbmcuIEkgZG9uXFwndCBrbm93IHdoYXQnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZXJyb3InLFxuICAgICAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IDIwMDBcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICBcbiAgICBcbiAgICAkc2NvcGUucG9zdENvbnRyb2xsZXIgPSBmYWxzZTtcbiAgICBcbiAgICAkc2NvcGUuJG9uKCd3czpuZXdfcG9zdCcsIGZ1bmN0aW9uKF8sIHBvc3QpIHtcbiAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRzY29wZS5wb3N0cy51bnNoaWZ0KHBvc3QpO1xuICAgICAgICAgICAgbmdOb3RpZnkuc2V0KCdBIG5ldyBwb3N0IHdhcyBwb3N0ZWQnLCB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ2luZm8nLFxuICAgICAgICAgICAgICAgIGR1cmF0aW9uOiAyMDAwXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSlcbiAgICB9KTtcbiAgICBcbiAgICAkc2NvcGUuJG9uKCd3czpkZWxldGVfcG9zdCcsIGZ1bmN0aW9uKF8sIHBvc3QpIHtcbiAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCgkc2NvcGUucG9zdHMsIGZ1bmN0aW9uKHZhbCwga2V5KSB7XG4gICAgICAgICAgICAgICAgaWYgKHZhbC5faWQgPT09IHBvc3QuX2lkICYmIHBvc3QudXNlcm5hbWUgIT09ICRyb290U2NvcGUudXNlcm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnBvc3RzLnNwbGljZSgkc2NvcGUucG9zdHMuaW5kZXhPZih2YWwpLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgbmdOb3RpZnkuc2V0KCdTb21lb25lIGRlbGV0ZWQgYSBwb3N0IDooJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3dhcm4nLFxuICAgICAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IDIwMDBcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgfSk7ICAgIFxuICAgIFxuICAgICRzY29wZS4kb24oJ3dzOnVwZGF0ZV9wb3N0JywgZnVuY3Rpb24oXywgcG9zdCkge1xuICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKCRzY29wZS5wb3N0cywgZnVuY3Rpb24odmFsLCBrZXkpIHtcbiAgICAgICAgICAgICAgICBpZiAodmFsLl9pZCA9PT0gcG9zdC5faWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsID0gcG9zdDtcbiAgICAgICAgICAgICAgICAgICAgbmdOb3RpZnkuc2V0KCdTb21lb25lIHVwZGF0ZWQgYSBwb3N0Jywge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2luZm8nLFxuICAgICAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IDIwMDBcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgIH0pO1xuICAgIFxuICAgIFxuICAgICRzY29wZS5kZWxldGUgPSBmdW5jdGlvbihwb3N0KSB7XG4gICAgICAgIGlmIChwb3N0LnVzZXJuYW1lID0gJHJvb3RTY29wZS51c2VybmFtZSkge1xuICAgICAgICAgICAgUG9zdHMucmVtb3ZlKHtpZDogcG9zdC5faWR9LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8ICRzY29wZS5wb3N0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBpZiAocG9zdC5faWQgPT09ICRzY29wZS5wb3N0c1tpXS5faWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgbmdOb3RpZnkuc2V0KCdZb3VyIHBvc3QgaXMgbm93IGRvb21lZCBpbnRvIG9ibGl2aW9uJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdlcnJvcicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IDIwMDBcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnBvc3RzLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBuZ05vdGlmeS5zZXQoJ0FyZSB5b3UgdHJ5aW5nIHNvbWV0aGluZyBmaXNoeT8nLCB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ2Vycm9yJyxcbiAgICAgICAgICAgICAgICBkdXJhdGlvbjogMjAwMFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgJHNjb3BlLmVkaXQgPSBmdW5jdGlvbihwb3N0KSB7XG4gICAgICAgICRsb2NhdGlvbi5wYXRoKCcvZWRpdC8nICsgcG9zdC5faWQpO1xuICAgIH1cbiAgICBcbiAgICAkc2NvcGUubG9nb3V0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIFVzZXJTZXJ2aWNlLmxvZ291dCgpO1xuICAgIH1cbiAgICBcbn1dKVxuICAgIFxuLmNvbnRyb2xsZXIoJ1Bvc3RDdHJsJywgWyckc2NvcGUnLCAnJHJvb3RTY29wZScsICckbG9jYXRpb24nLCAnJGh0dHAnLCAnJHdpbmRvdycsICduZ05vdGlmeScsICckdGltZW91dCcsICdVc2VyU2VydmljZScsIGZ1bmN0aW9uKCRzY29wZSwgJHJvb3RTY29wZSwgJGxvY2F0aW9uLCAkaHR0cCwgJHdpbmRvdywgbmdOb3RpZnksICR0aW1lb3V0LCBVc2VyU2VydmljZSkgeyAgICBcbiAgICAkc2NvcGUucG9zdENvbnRyb2xsZXIgPSB0cnVlO1xuXG4gICAgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ1gtQXV0aCddID0gJHdpbmRvdy5zZXNzaW9uU3RvcmFnZS50b2tlbjtcblxuICAgIFVzZXJTZXJ2aWNlLmdldFVzZXIoKS5zdWNjZXNzKGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgJHJvb3RTY29wZS5jdXJyZW50VXNlciA9IHVzZXI7XG4gICAgICAgICRyb290U2NvcGUudXNlcm5hbWUgPSB1c2VyLnVzZXJuYW1lO1xuICAgIH0pXG4gICAgXG4gICAgJHNjb3BlLnN1Ym1pdCA9IGZ1bmN0aW9uKHBvc3QpIHtcbiAgICAgICAgaWYgKHBvc3QgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgIG5nTm90aWZ5LnNldCgnRW1wdHkgcG9zdCwgZWg/Jywge1xuICAgICAgICAgICAgICAgIHR5cGU6ICdlcnJvcicsXG4gICAgICAgICAgICAgICAgZHVyYXRpb246IDIwMDBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcG9zdC51c2VybmFtZSA9ICRyb290U2NvcGUudXNlcm5hbWU7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgICRodHRwLnBvc3QoJy9hcGkvcG9zdHMnLCBwb3N0KVxuICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uKG5ld1Bvc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgbmdOb3RpZnkuc2V0KCdZb3VyIHBvc3Qgd2FzIGFkZGVkIHRvIHRoZSBicmlsbGlhbnQgYXJjaGl2ZScsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdzdWNjZXNzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiAxMDAwXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvbWFpbicpO1xuICAgICAgICAgICAgICAgICAgICB9LCAxMDAwKVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnU29tZXRoaW5nIHdlbnQgd3JvbmcnKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICB9XG4gICAgXG4gICAgJHNjb3BlLmxvZ291dCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBVc2VyU2VydmljZS5sb2dvdXQoKTtcbiAgICB9XG59XSlcblxuLmNvbnRyb2xsZXIoJ0VkaXRDdHJsJywgWyckc2NvcGUnLCAnJHJvb3RTY29wZScsICckbG9jYXRpb24nLCAnJGh0dHAnLCAnJHdpbmRvdycsICduZ05vdGlmeScsICckc3RhdGVQYXJhbXMnLCAnJHRpbWVvdXQnLCAnVXNlclNlcnZpY2UnLCBmdW5jdGlvbigkc2NvcGUsICRyb290U2NvcGUsICRsb2NhdGlvbiwgJGh0dHAsICR3aW5kb3csIG5nTm90aWZ5LCAkc3RhdGVQYXJhbXMsICR0aW1lb3V0LCBVc2VyU2VydmljZSkgeyAgICBcblxuICAgICRodHRwLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWydYLUF1dGgnXSA9ICR3aW5kb3cuc2Vzc2lvblN0b3JhZ2UudG9rZW47XG4gICAgXG4gICAgVXNlclNlcnZpY2UuZ2V0VXNlcigpLnN1Y2Nlc3MoZnVuY3Rpb24odXNlcikge1xuICAgICAgICAkcm9vdFNjb3BlLmN1cnJlbnRVc2VyID0gdXNlcjtcbiAgICAgICAgJHJvb3RTY29wZS51c2VybmFtZSA9IHVzZXIudXNlcm5hbWU7XG4gICAgfSlcbiAgICBcbiAgICAkaHR0cC5nZXQoJy9hcGkvcG9zdC8nICsgJHN0YXRlUGFyYW1zLmlkKVxuICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24ocG9zdCkge1xuICAgICAgICAgICAgICAgICRzY29wZS5wb3N0ID0gcG9zdDtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgICAgICAgICAgbmdOb3RpZnkuc2V0KCdTb21ldGhpbmcgd2VudCB3cm9uZy4gSSBkb25cXCd0IGtub3cgd2hhdCcsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdlcnJvcicsXG4gICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogMjAwMFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgJHNjb3BlLnN1Ym1pdCA9IGZ1bmN0aW9uKHBvc3QpIHtcbiAgICAgICAgaWYgKHBvc3QgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgIG5nTm90aWZ5LnNldCgnRW1wdHkgcG9zdCwgZWg/Jywge1xuICAgICAgICAgICAgICAgIHR5cGU6ICdlcnJvcicsXG4gICAgICAgICAgICAgICAgZHVyYXRpb246IDIwMDBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgJGh0dHAucHV0KCcvYXBpL3VwZGF0ZScsIHBvc3QpXG4gICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24obmV3UG9zdCkge1xuICAgICAgICAgICAgICAgICAgICBuZ05vdGlmeS5zZXQoJ1lvdXIgcG9zdCB3YXMgYWRkZWQgdXBkYXRlZCcsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdzdWNjZXNzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiAxMDAwXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvbWFpbicpO1xuICAgICAgICAgICAgICAgICAgICB9LCAxMDAwKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1NvbWV0aGluZyB3ZW50IHdyb25nJyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gXG4gICAgfVxuICAgIFxuICAgICRzY29wZS5sb2dvdXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgVXNlclNlcnZpY2UubG9nb3V0KCk7XG4gICAgfVxufV0pIiwiYW5ndWxhci5tb2R1bGUoJ2FwcC5zZXJ2aWNlcycsIFtdKVxuXG4uc2VydmljZSgnVXNlclNlcnZpY2UnLCBmdW5jdGlvbigkaHR0cCwgJGxvY2F0aW9uLCAkd2luZG93KSB7XG4gICAgdmFyIHNlcnZpY2UgPSB0aGlzO1xuICAgIFxuICAgIHRoaXMuZ2V0VXNlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvY3VycmVudFVzZXInLCB7XG4gICAgICAgICAgICBoZWFkZXJzOiB7ICdYLUF1dGgnOiB3aW5kb3cuc2Vzc2lvblN0b3JhZ2UudG9rZW4gfVxuICAgICAgICB9KVxuICAgIH1cbiAgICBcbiAgICB0aGlzLmxvZ291dCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBkZWxldGUgc2VydmljZS50b2tlblxuICAgICAgICBkZWxldGUgJHdpbmRvdy5zZXNzaW9uU3RvcmFnZS50b2tlbjtcbiAgICAgICAgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ1gtQXV0aCddID0gbnVsbDtcbiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKTtcbiAgICB9XG5cbn0pXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=